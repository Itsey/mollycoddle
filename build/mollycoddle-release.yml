parameters:
  - name: PreRelease
    displayName: 'PreRelease'
    type: boolean
    default: true  

trigger: none

stages:
  - stage: MollycoddleRelease
    displayName: 'Mollycoddle Release'
    dependsOn: [  ]

    pool:
      name: 'FarawayLand'  

    jobs:
      - job: Build
        displayName: 'Mollycoddle CCD'
        dependsOn: [  ]
        steps:
          - task: CmdLine@2
            displayName: 'Run: ArrangeStep'
            inputs:
              script: '.\src\build.cmd ArrangeStep Clean MollyCheck --root .\src\ --PreRelease ${{ parameters.PreRelease }}'

          - task: CmdLine@2
            displayName: 'Run: ConstructStep'
            name: ConstructStep
            inputs:
              script: '.\src\build.cmd ConstructStep Compile --skip ArrangeStep --root .\src\ --PreRelease ${{ parameters.PreRelease }}'
      
          - task: CmdLine@2
            displayName: 'Run: ExamineStep'
            inputs:
              script: '.\src\build.cmd ExamineStep --skip ArrangeStep ConstructStep --root .\src\ --PreRelease ${{ parameters.PreRelease }}'
              
          - task: CmdLine@2
            displayName: 'Run: PackageStep'
            inputs:
              script: '.\src\build.cmd PackageStep --skip ArrangeStep ConstructStep ExamineStep --root .\src\ --PreRelease ${{ parameters.PreRelease }}'

          - task: CmdLine@2
            displayName: 'Run: ReleaseStep'
            inputs:
              script: '.\src\build.cmd ReleaseStep --skip ArrangeStep ConstructStep ExamineStep PackageStep --root .\src\ --PreRelease ${{ parameters.PreRelease }}  --FullVersionNumber ${ConstructStep.FullVersionNumber}'

          - task: CmdLine@2
            displayName: 'Run: TestStep'
            inputs:
              script: '.\src\build.cmd TestStep --skip ArrangeStep ConstructStep ExamineStep PackageStep ReleaseStep --root .\src\ --PreRelease ${{ parameters.PreRelease }}'